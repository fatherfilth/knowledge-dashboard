---
phase: 07-tag-discovery
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/tags.ts
  - src/app/tags/[tag]/page.tsx
  - src/components/ui/ArticleCard.tsx
  - src/components/ui/ArticleMetadata.tsx
  - src/components/ui/RelatedArticles.tsx
  - src/app/[category]/[slug]/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can click a tag on any article card to see all articles with that tag"
    - "Tag pages display article cards for all matching articles across categories"
    - "Article pages show related articles based on shared tags"
    - "Related articles section is hidden when no related articles exist"
    - "Tags on article detail pages are clickable links to tag pages"
  artifacts:
    - path: "src/lib/tags.ts"
      provides: "Tag utilities: slug normalization, tag extraction, filtering, related article scoring"
      exports: ["tagToSlug", "slugToTag", "getAllTags", "getAllTagSlugs", "getTagDisplayName", "getArticlesByTag", "getRelatedArticles"]
    - path: "src/app/tags/[tag]/page.tsx"
      provides: "Dynamic tag page with static generation"
      exports: ["generateStaticParams", "generateMetadata", "default"]
    - path: "src/components/ui/RelatedArticles.tsx"
      provides: "Related articles section component"
      exports: ["RelatedArticles"]
    - path: "src/components/ui/ArticleCard.tsx"
      provides: "Article card with clickable tag links"
      contains: "tagToSlug"
    - path: "src/components/ui/ArticleMetadata.tsx"
      provides: "Article metadata with clickable tag links"
      contains: "tagToSlug"
    - path: "src/app/[category]/[slug]/page.tsx"
      provides: "Article page with related articles section"
      contains: "RelatedArticles"
  key_links:
    - from: "src/components/ui/ArticleCard.tsx"
      to: "/tags/[tag]"
      via: "Link with tagToSlug(tag) in href"
      pattern: "href=.*tags.*tagToSlug"
    - from: "src/app/tags/[tag]/page.tsx"
      to: "src/lib/tags.ts"
      via: "getArticlesByTag and getAllTagSlugs"
      pattern: "getArticlesByTag|getAllTagSlugs"
    - from: "src/app/[category]/[slug]/page.tsx"
      to: "src/components/ui/RelatedArticles.tsx"
      via: "RelatedArticles component receiving getRelatedArticles output"
      pattern: "getRelatedArticles.*RelatedArticles"
---

<objective>
Implement tag-based browsing and related article discovery for Phase 7.

Purpose: Users can discover articles by clicking tags (cross-category browsing) and find related content on article pages (tag overlap scoring). This completes the content discovery features before Phase 8 design polish.

Output: Tag utility library, dynamic /tags/[tag] pages, clickable tags on cards and article pages, RelatedArticles component on article detail pages.
</objective>

<execution_context>
@C:/Users/Karl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Karl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-tag-discovery/07-RESEARCH.md
@src/lib/content.ts
@src/types/content.ts
@src/lib/schemas/article.ts
@src/components/ui/ArticleCard.tsx
@src/components/ui/ArticleMetadata.tsx
@src/app/[category]/[slug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Tag utilities, tag page route, and clickable tags</name>
  <files>
    src/lib/tags.ts
    src/app/tags/[tag]/page.tsx
    src/components/ui/ArticleCard.tsx
    src/components/ui/ArticleMetadata.tsx
  </files>
  <action>
Create `src/lib/tags.ts` with all tag utility functions. Reference the complete implementation in 07-RESEARCH.md "Complete Tag Utilities Library" section. The file must export:

- `tagToSlug(tag: string): string` -- normalize tag to URL-safe slug (lowercase, hyphens, strip special chars). Import `Article` type from `@/types/content` and `fetchAllArticles` from `./content`.
- `slugToTag(slug: string): string` -- reverse slug to display format (replace hyphens with spaces).
- `getAllTags(): Promise<string[]>` -- extract all unique tags from all articles using Set.
- `getAllTagSlugs(): Promise<string[]>` -- get unique tag slugs (normalized, deduplicated via second Set).
- `getTagDisplayName(slug: string): Promise<string | null>` -- find original casing from first matching article.
- `getArticlesByTag(slug: string): Promise<Article[]>` -- filter articles by normalized tag match, clone-before-sort by updated date descending.
- `calculateTagOverlap(article1, article2): number` -- (not exported) Set intersection count of normalized tags.
- `getRelatedArticles(currentArticle, limit = 3): Promise<Article[]>` -- find articles with most shared tags, exclude current article, filter overlap > 0, sort descending by overlap, slice to limit.

Create `src/app/tags/[tag]/page.tsx` with:
- `export const dynamicParams = false` -- 404 for tags not in generateStaticParams.
- `generateStaticParams()` using `getAllTagSlugs()` -- returns `{ tag }` for each slug.
- `generateMetadata()` using `getTagDisplayName()` -- title: "{DisplayName} Articles | Ryder.AI".
- Default export `TagPage` -- async component, awaits params (Next.js 16 pattern), calls `getArticlesByTag(tag)` and `getTagDisplayName(tag)`. If no displayName or zero articles, call `notFound()`. Render: back link to home, h1 with display name, article count text, grid of `ArticleCard` components (grid-cols-1 md:grid-cols-2 gap-4 md:gap-6). Match existing layout pattern: `mx-auto max-w-5xl px-6 py-12`.

Modify `src/components/ui/ArticleCard.tsx`:
- Import `Link` from "next/link" (already imported) and `tagToSlug` from `@/lib/tags`.
- Change tag `<span>` elements to `<Link>` elements with `href={/tags/${tagToSlug(tag)}}`.
- Add `relative z-10` classes to tag Links (above card's pseudo-element overlay).
- Add `hover:bg-gray-200` for hover feedback.
- Add `onClick={(e) => e.stopPropagation()}` to prevent card navigation on tag click.
- Keep existing overflow "+N more" span unchanged.

Modify `src/components/ui/ArticleMetadata.tsx`:
- Import `Link` from "next/link" and `tagToSlug` from `@/lib/tags`.
- Change tag `<span>` elements to `<Link>` elements with `href={/tags/${tagToSlug(tag)}}`.
- Add `hover:bg-gray-200` for hover feedback. These are on the article detail page, no z-10 needed (no pseudo-element overlay here).
  </action>
  <verify>
Run `npx next build` -- must succeed with tag routes generated. Check build output shows `/tags/[tag]` routes. Verify no TypeScript errors with `npx tsc --noEmit`.
  </verify>
  <done>
Tag utility library exists with all exports. Tag pages generate statically for all unique tags. Clicking a tag on any ArticleCard navigates to /tags/{slug} showing matching articles. Tags on article metadata are also clickable. Build passes with zero errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Related articles component on article pages</name>
  <files>
    src/components/ui/RelatedArticles.tsx
    src/app/[category]/[slug]/page.tsx
  </files>
  <action>
Create `src/components/ui/RelatedArticles.tsx`:
- Accept `{ articles: Article[] }` prop. Import `Article` type from `@/types/content` and `ArticleCard` from `./ArticleCard`.
- If `articles.length === 0`, return `null` (do NOT render empty heading).
- Render a `<section>` with `mt-12 border-t border-gray-200 pt-8` classes (visual separator from article content).
- h2 "Related Articles" with `mb-6 text-2xl font-bold text-gray-900`.
- Grid of ArticleCard components: `grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3`.

Modify `src/app/[category]/[slug]/page.tsx`:
- Import `getRelatedArticles` from `@/lib/tags`.
- Import `RelatedArticles` from `@/components/ui/RelatedArticles`.
- After finding the article and before the return, call `const relatedArticles = await getRelatedArticles(article, 3)`.
- Add `<RelatedArticles articles={relatedArticles} />` after the closing `</article>` tag, inside the outer div.
  </action>
  <verify>
Run `npx next build` -- must succeed. Navigate to an article page during dev (`npx next dev`) and confirm related articles appear below the content when the article has tags that overlap with other articles. Confirm the section does not appear for articles with no tag overlap.
  </verify>
  <done>
RelatedArticles component renders 0-3 related articles below article content. Articles with shared tags show related content. Articles with unique or no tags show no related section. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `npx next build` completes successfully with /tags/[tag] routes in output
2. `npx tsc --noEmit` passes with zero TypeScript errors
3. Tag pages render article cards filtered by tag
4. Clicking a tag on ArticleCard navigates to /tags/{slug} (not to article)
5. Clicking a tag on ArticleMetadata navigates to /tags/{slug}
6. Article pages show "Related Articles" section when tag overlap exists
7. Article pages hide related section when no overlap exists
8. All existing pages still render correctly (no regressions)
</verification>

<success_criteria>
- All 4 phase success criteria are met:
  1. User can click a tag to see all articles with that tag across categories
  2. Tag pages display article cards for all matching articles
  3. Article pages show related articles based on shared tags
  4. Related articles appear in a dedicated section on article pages
- Build passes with zero errors
- No new dependencies added (native JavaScript only)
</success_criteria>

<output>
After completion, create `.planning/phases/07-tag-discovery/07-01-SUMMARY.md`
</output>
