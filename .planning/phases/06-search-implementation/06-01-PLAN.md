---
phase: 06-search-implementation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/search/SearchBar.tsx
  - src/components/search/SearchResults.tsx
  - src/app/search/page.tsx
  - src/app/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Search bar is accessible from all pages (visible in root layout)"
    - "User can type a keyword and see matching articles on /search page"
    - "Search matches against article title, content, and tags with fuzzy matching"
    - "Search results display as ArticleCard components"
    - "Search tolerates typos and partial matches (threshold 0.3)"
  artifacts:
    - path: "src/components/search/SearchBar.tsx"
      provides: "Client component with debounced input and URL state management"
      contains: "use client"
    - path: "src/components/search/SearchResults.tsx"
      provides: "Client component with lazy-loaded Fuse.js and ArticleCard rendering"
      contains: "import('fuse.js')"
    - path: "src/app/search/page.tsx"
      provides: "Search page reading searchParams and passing to client components"
      contains: "fetchAllArticles"
    - path: "src/app/layout.tsx"
      provides: "Root layout with SearchBar accessible from all pages"
      contains: "SearchBar"
  key_links:
    - from: "src/components/search/SearchBar.tsx"
      to: "/search?q=term"
      via: "useRouter replace with useSearchParams"
      pattern: "replace.*search.*q"
    - from: "src/components/search/SearchResults.tsx"
      to: "fuse.js"
      via: "dynamic import inside useEffect"
      pattern: "import\\('fuse\\.js'\\)"
    - from: "src/components/search/SearchResults.tsx"
      to: "src/components/ui/ArticleCard.tsx"
      via: "renders ArticleCard for each result"
      pattern: "ArticleCard"
    - from: "src/app/search/page.tsx"
      to: "src/lib/content.ts"
      via: "fetchAllArticles at build time"
      pattern: "fetchAllArticles"
    - from: "src/app/layout.tsx"
      to: "src/components/search/SearchBar.tsx"
      via: "Suspense-wrapped import in layout"
      pattern: "Suspense.*SearchBar"
---

<objective>
Implement client-side fuzzy search across all articles using Fuse.js with URL-based state management.

Purpose: Enable users to find articles by keyword from any page, with fuzzy matching that tolerates typos and partial matches.
Output: SearchBar component in global layout, SearchResults component, /search page, and Fuse.js integration with lazy loading.
</objective>

<execution_context>
@C:/Users/Karl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Karl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-search-implementation/06-RESEARCH.md
@src/components/ui/ArticleCard.tsx
@src/types/content.ts
@src/lib/content.ts
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create SearchBar and SearchResults components</name>
  <files>
    src/components/search/SearchBar.tsx
    src/components/search/SearchResults.tsx
  </files>
  <action>
Install fuse.js and use-debounce:
```bash
npm install fuse.js use-debounce
```

Create `src/components/search/SearchBar.tsx` as a client component:
- 'use client' directive at top
- Import useSearchParams, useRouter from 'next/navigation'
- Import useDebouncedCallback from 'use-debounce'
- On input change, debounce at 300ms, then:
  - If on /search page (check pathname), update URL params in-place with replace()
  - If on any other page, navigate to /search?q=term using replace()
- Use `defaultValue={searchParams.get('q')?.toString()}` (NOT controlled value prop — URL is source of truth)
- Input type="search" with aria-label="Search articles" and placeholder "Search articles..."
- Handle Escape key: clear input value and search param
- Style with Tailwind: rounded border, padding, search icon (use inline SVG magnifying glass, do NOT import heroicons — not installed)

Create `src/components/search/SearchResults.tsx` as a client component:
- 'use client' directive at top
- Props: { query: string; articles: Article[] }
- Import type Fuse from 'fuse.js' (type-only import at top)
- Import ArticleCard from '@/components/ui/ArticleCard'
- Use useState for results and isLoading
- In useEffect triggered by [query, articles]:
  - If no query: setResults to all articles, return early
  - Set isLoading true
  - Dynamic import: `import('fuse.js').then(({ default: FuseClass }) => ...)`
  - Create Fuse instance with CLONED articles: `new FuseClass([...articles], fuseOptions)`
  - Fuse options: keys with weights (title: 2, tags: 1.5, content: 1), threshold: 0.3, ignoreLocation: true, minMatchCharLength: 2
  - Map results with `.map(r => r.item)`, set results, set isLoading false
- Render three states:
  1. isLoading: "Searching..." text
  2. query exists but 0 results: "No articles found for '{query}'" with suggestion to try different keywords
  3. Results: grid of ArticleCard components (grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 — matches category page pattern)
- When no query is provided, show a prompt message "Enter a search term to find articles" instead of all articles (keeps the page clean)
  </action>
  <verify>
Run `npm ls fuse.js use-debounce` to confirm dependencies installed. Run `npx tsc --noEmit` to confirm no TypeScript errors in the new components.
  </verify>
  <done>
SearchBar.tsx exists as a client component with debounced URL-based search input. SearchResults.tsx exists as a client component that lazy-loads Fuse.js, searches with weighted keys and threshold 0.3, and renders ArticleCard components. Both compile without TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create /search page and add SearchBar to root layout</name>
  <files>
    src/app/search/page.tsx
    src/app/layout.tsx
  </files>
  <action>
Create `src/app/search/page.tsx` as a server component:
- Export generateMetadata returning { title: 'Search | Ryder.AI', description: 'Search across all AI documentation articles' }
- Page component receives `searchParams` prop as `Promise<{ q?: string }>` (Next.js 16 async pattern — must await it)
- Await searchParams, extract query: `const query = params?.q || ''`
- Call `fetchAllArticles()` to get all articles at build time
- Render page with heading "Search Articles", result count when query exists
- Wrap SearchBar in `<Suspense fallback={<div className="h-10" />}>` (height preserves layout during load)
- Render SearchResults below with query and articles props
- Style consistently with category pages: max-w-5xl mx-auto px-6 py-12
- Add back link to homepage: "← Back to Home" matching category page pattern

Update `src/app/layout.tsx`:
- Import SearchBar and Suspense
- Add a header/nav bar to the body containing:
  - Left side: Link to "/" with "Ryder.AI" text (site name, font-semibold)
  - Right side: SearchBar component wrapped in Suspense with fallback
- Header should be a simple bar: border-b border-gray-200, px-6 py-3, flex items-center justify-between, max-w-5xl mx-auto (or full-width with inner constraint)
- Keep existing body classes (bg-white font-sans text-gray-900 antialiased)
- The SearchBar in the layout should be a compact version — when used in layout, navigates to /search?q=term on input; when on /search page, updates URL in-place. The SearchBar component already handles this via pathname detection (built in Task 1).
  </action>
  <verify>
Run `npm run build` to confirm the /search page generates successfully and the layout compiles. Verify the build output includes /search in the generated routes.
  </verify>
  <done>
The /search page exists at src/app/search/page.tsx, fetches all articles, reads the q search param, and renders SearchBar + SearchResults. The root layout at src/app/layout.tsx includes a header with site name and SearchBar wrapped in Suspense, making search accessible from every page. Build succeeds with /search route in output.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors and /search route appears in build output
2. `npx tsc --noEmit` passes with no type errors
3. Fuse.js is NOT in the main bundle (it's dynamically imported) — verify by checking that SearchResults.tsx uses `import('fuse.js')` not top-level import
4. SearchBar appears in the root layout header (accessible from all pages)
5. SearchBar is wrapped in Suspense boundary in both layout and search page
</verification>

<success_criteria>
- Search bar visible on all pages via root layout header
- /search page renders with SearchBar and SearchResults
- Typing a query updates URL to /search?q=term with 300ms debounce
- Fuse.js lazy-loads only when a search query is entered
- Search uses weighted keys (title: 2, tags: 1.5, content: 1) with threshold 0.3
- Results render as ArticleCard components in responsive grid
- Empty query shows prompt message, no-results shows helpful message
- Build succeeds with all routes generated
</success_criteria>

<output>
After completion, create `.planning/phases/06-search-implementation/06-01-SUMMARY.md`
</output>
